name: Run All Trackers
on:
  schedule:
    - cron: '0 22 * * *'    # 오전 7시 KST (UTC+9)
    - cron: '0 10 * * *'    # 오후 7시 KST
    # 오후 3시 30분 KST (UTC 06:30) 제거 → ps_tracker 핵심 크롤링 구간(UTC 01~08시)과 겹침
  workflow_dispatch:
jobs:
  trigger-all:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Exchange Rate
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.PAT_TOKEN }}
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'exchange_workflow.yml',
              ref: 'main'
            });
      
      - name: Wait 2 seconds
        run: sleep 2
      
      - name: Trigger PS Tracker
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.PAT_TOKEN }}
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'ps_tracker.yml',
              ref: 'main'
            });
      
      - name: Wait 2 seconds
        run: sleep 2
      
      - name: Trigger Steam Tracker
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.PAT_TOKEN }}
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'steam_workflow.yml',
              ref: 'main'
            });
      
      - name: Wait 2 seconds
        run: sleep 2
      
      - name: Trigger Trends Tracker
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.PAT_TOKEN }}
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'trends_workflow.yml',
              ref: 'main'
            });
      
      - name: Wait 2 seconds
        run: sleep 2
      
      - name: Trigger YouTube Tracker
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.PAT_TOKEN }}
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'youtube_workflow.yml',
              ref: 'main'
            });
      
      - name: Wait 2 seconds
        run: sleep 2
      
      - name: Trigger Crimson Competitors Tracker
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.PAT_TOKEN }}
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'crimson_competitors_workflow.yml',
              ref: 'main'
            });
      
      - name: Wait 2 seconds
        run: sleep 2
      
      - name: Trigger Game Stock Analyzer
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.PAT_TOKEN }}
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'game_stock_workflow.yml',
              ref: 'main'
            });
      
      - name: Wait 2 seconds
        run: sleep 2
      
      - name: Trigger Generate Ranking Plots
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.PAT_TOKEN }}
          script: |
            await github.rest.actions.createWorkflowDispatch({
              owner: context.repo.owner,
              repo: context.repo.repo,
              workflow_id: 'generate_plots.yml',
              ref: 'main'
            });
      
      - name: All workflows triggered
        run: echo "✅ All 8 trackers have been triggered successfully!"
