name: Crimson Desert Countdown Notifier

on:
  schedule:
    - cron: "0 22 * * *"   # UTC 22:00 = KST 07:00
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Calculate D-Day
        id: dday
        run: |
          RELEASE_DATE="2026-03-19"
          TODAY=$(date -u +"%Y-%m-%d")

          RELEASE_TS=$(date -d "$RELEASE_DATE" +%s)
          TODAY_TS=$(date -d "$TODAY" +%s)

          DAYS_LEFT=$(( (RELEASE_TS - TODAY_TS) / 86400 ))

          if [ "$DAYS_LEFT" -lt 0 ]; then
            MESSAGE="ğŸš€ ì˜¤ëŠ˜ ì¶œì‹œ!"
          elif [ "$DAYS_LEFT" -eq 0 ]; then
            MESSAGE="ğŸš€ ì¶œì‹œì¼!"
          elif [ "$DAYS_LEFT" -le 30 ]; then
            MESSAGE="ğŸ”¥ ì¶œì‹œ ì„ë°• D-$DAYS_LEFT"
          else
            MESSAGE="â³ D-$DAYS_LEFT"
          fi

          echo "DAYS_LEFT=$DAYS_LEFT" >> $GITHUB_ENV
          echo "MESSAGE=$MESSAGE" >> $GITHUB_ENV

      - name: Send Discord Embed
        run: |
          curl -X POST \
            -H "Content-Type: application/json" \
            -d "{
              \"embeds\": [{
                \"title\": \"ğŸ® Crimson Desert ì¶œì‹œ ì¹´ìš´íŠ¸ë‹¤ìš´\",
                \"description\": \"ğŸ“… ì¶œì‹œì¼: 2026-03-19\\n${MESSAGE}\",
                \"color\": 16729344,
                \"thumbnail\": {
                  \"url\": \"https://cdn.cloudflare.steamstatic.com/steam/apps/3321460/header.jpg\"
                },
                \"fields\": [
                  {
                    \"name\": \"ğŸ”— í”Œë«í¼ ë§í¬\",
                    \"value\": \"[Steam](https://store.steampowered.com/app/3321460) | [PlayStation](https://store.playstation.com) | [Xbox](https://www.xbox.com) | [SteamDB](https://steamdb.info/app/3321460/charts/)\"
                  }
                ],
                \"footer\": {
                  \"text\": \"ìë™ ì•Œë¦¼ ì‹œìŠ¤í…œ\"
                }
              }]
            }" \
            ${{ secrets.DISCORD_WEBHOOK }}
